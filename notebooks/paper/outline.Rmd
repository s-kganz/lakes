---
title: "Modeling Maximum Depth for all Lakes in the United States"
author:
- Keenan Ganz
output:
  bookdown::pdf_document2:
    toc: false
bibliography: C:\\users\\ganzk\\desktop\\lakes\\notebooks\\bibliography.bib
csl: C:\\users\\ganzk\\desktop\\lakes\\notebooks\\american-institute-of-physics.csl
nocite: |
  @oliverPredictionLakeDepth2016, @heathcotePredictingBathymetricFeatures2015 |
  @sobekPredictingDepthVolume2011, @hollisterPredictingMaximumLake2011a
---

```{r setup, echo=F, message=F}
knitr::opts_knit$set(root.dir = normalizePath("../.."))
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```
```{r libraries}
library(igraph)
library(sf)
library(tidyverse)
library(caret)
library(randomForest)
library(ggridges)
library(latex2exp)
library(mgcv)
```

```{r previousModelTable}
tibble(
  "Citation"=c("Oliver et al. (2016)", "Hollister et al. (2011)", "Heathcote et al. (2015)", "Sobek (2011)"),
  "Region"=c("Northeastern US", "NHD HUC 01 and 02", "Southern Quebec", "Sweden"),
  "Model"=c("Linear mixed effects", "Linear regression", "Log-transformed linear regression", "Log-transformed linear regression and partial least squares regression"),
  "Predictors"=c("Area, shoreline development index, maximum buffer slope, watershed to lake area ratio", "Median buffer slope", "Elevation change 25m from lake", "Lake area, perimeter, median slope"),
  "Maximum Depth $R^2$"=c(0.29, "0.48-0.67", 0.52, 0.36),
  "RMSE"=c("7.1m", "5.09-5.95m", "0.245 $\\log_{10}$m", "Not reported")
) %>%
  pander::pander(caption="Summary of existing models of maximum lake depth, using local topography and regional characteristics. $\\hat{Z}$: maximum lake depth; $D$: maximum distance from shore in lake; $S_{median}$: median slope in lake catchment.")
```

# Introduction
# Methods
## Lake Data Sources
Lake polygons, depth measurements, and other lake attributes were derived from LAGOS-US LOCUS and DEPTH modules[@cheruvelilLAGOSUSLOCUSV12021; @stachelekLAGOSUSDEPTHV12021]. Candidate predictor variables were identified from the four tables included in the LOCUS module. Polygon attributes, including area, perimeter, shoreline development index, maximum distance from shoreline, and oriented bounding box length-width ratio, were calculated within QGIS[@qgisdevelopmentteamQGISGeographicInformation2021].

## Terrain Analysis
Terrain metrics were derived from the Shuttle Radar Topography Mission 30m digital elevation model within 200m buffer zones around each lake polygon[@farrShuttleRadarTopography2007]. Although other digital elevation models offer finer resolution within the US, SRTM is available worldwide such that the depth model described here may be applied outside of the US.

All terrain analysis was carried out with Google Earth Engine (GEE)[@gorelickGoogleEarthEngine2017a]. Predictor variables from the four models summarized in \@ref(tab:previousModelTable) were replicated as closely as possible within the GEE environment. Additional predictors, including buffer elevation, buffer slope, terrain roughness index, horizontal curvature, and kernel-based metrics were included to fully describe the topography of lake buffer zones[@safanelliTerrainAnalysisGoogle2020]. Each metric was calculated for all SRTM pixels within a buffer zone and summarized as the minimum, maximum, mean, and standard deviation.

Kernel-based metrics applied summary statistics to all pixels within a given distance of a central pixel. This captures terrain features at a variety of scales. Terrain relief was calculated as the maximum difference between the central pixel and all other pixels in the kernel. Terrain deviation was calculated as the difference between the central pixel and the mean elevation of all pixels in the kernel, normalized to the standard deviation of all pixels in the kernel.

## Spatial Autocorrelation
After Oliver et al., spatial autocorrelation was assumed at the HUC04 scale. Additional predictors were generated by summarizing terrain metrics, polygon attributes, and lake depth within each HUC04 unit.

## Modeling Workflow
Comparison of existing lake depth models has been impeded by inconsistent source data and small study areas. All models in \@ref{tab:previous-model-table} were replicated on the LAGOS-US DEPTH data module. Oliver et al. excluded lakes larger than 1000ha from modeling since depth is known for over 80% of these lakes. A similar proportion (72.5%) of large lakes larger than 1000ha had known maximum depth in the LAGOS-US DEPTH module, so these were excluded from modeling.

### Random Forest Model
The above workflow generated a tabular dataset with 106 candidate predictors of maximum lake depth. Random forest modeling was used for its robustness to multicollinearity and ability to capture nonlinear relationships. However, random forest regression models are less effective when forecasting beyond data in the training set. Feature selection was performed with the R package `Boruta` to screen out ineffective predictors. The Boruta algorithm proceeds by generating a random forest model for a regression problem and iteratively comparing the importance of a candidate predictor with random noise[@kursaFeatureSelectionBoruta2010]. Candidate predictors that outperformed random noise were retained in the random forest model and all others were discarded.

\newpage
# References

<!-- # Introduction -->
<!--  - Summary of prior models in the literature -->
<!-- # Methods -->
<!-- ## Data Sources -->
<!--  - LAGOS US, LAGOS NE, NLA -->
<!-- ## Terrain Analysis -->
<!--  - 30m SRTM DEM -->
<!--  - Elevation, Slope, Curvature -->
<!--  - Kernel-based metrics -->
<!-- ## Modeling Workflow -->
<!--   - Feature selection -->
<!--   - Monte Carlo test for significance -->
<!-- ## Lake volume estimation -->
<!--   - cone approximation -->
<!-- # Results -->
<!-- # Discussion -->

<!-- Key figures and tables -->
<!-- Table 1: Summary of previous modeling studies -->
<!--   Ref, equation, location, n, R2, RMSE -->
<!-- Table 2: Summary of candidate predictors and where they come from -->
<!-- Table 3: Summary of modeling results -->
<!--   Ref, R2 (RMSE) for NLA, LAGOS NE, LAGOS US -->

<!-- Figure 2: Diagram of why curvature improves depth estimate -->
<!-- Figure 1: 1:1 plots for each of the tested models (training & validation) -->